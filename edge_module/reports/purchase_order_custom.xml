<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <template id="purchase_order_custom" inherit_id="purchase.report_purchaseorder_document">
        <xpath expr="//div[hasclass('page')]" position="after">
            <div class="oe_link_field: text-center" style="20px">
                <a href="https://edgeautonomy.io/about-us/solutions-terms-and-conditions/" target="_blank">Edge Autonomy Terms and Conditions</a>
            </div>
        </xpath>
        <xpath expr="//thead/tr/th[@name='th_description']" position="before">
            <th name="th_line_number"><strong>L.#.</strong></th>
        </xpath>
        <xpath expr="//thead/tr/th[@name='th_description']" position="after">
            <th name="th_vendor_number"><strong>Vendor PN</strong></th>
        </xpath>
        <xpath expr="//td[@name='td_taxes']" position="before">
            <td name="Vendor PN">
                <span t-field="line.vendor_number"/>
            </td>
        </xpath>
        <xpath expr="//tbody/tr/td[1]" position="before">
            <t t-set="current_subtotal" t-value="0"/>
            <t t-set="row_number" t-value="1"/> <!-- Initialize row number -->
            <t t-foreach="o.order_line" t-as="line">
                <t t-set="current_subtotal" t-value="current_subtotal + line.price_subtotal"/>
                <tr t-att-class="'bg-200 fw-bold o_line_section' if line.display_type == 'line_section' else 'fst-italic o_line_note' if line.display_type == 'line_note' else ''">
                    <td class="text-center"><strong>vendor number</strong></td>
                    <td class="text-center"><span t-esc="row_number"/></td> <!-- Display row number -->
                    <t t-if="not line.display_type"></t> <!-- Correctly close the control structure -->
                </tr>
            </t>
        </xpath>
    </template>
</odoo>
